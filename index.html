<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>For You ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Force background into Safari's top/bottom bars */
        html { background-color: #fff5f5; }

        body, html {
            margin: 0; padding: 0; 
            width: 100%; height: 100%;
            height: -webkit-fill-available;
            font-family: 'Poppins', sans-serif;
            background-color: #fff5f5;
            background-image: linear-gradient(90deg, rgba(255, 77, 109, 0.05) 50%, transparent 50%),
                              linear-gradient(rgba(255, 77, 109, 0.05) 50%, transparent 50%);
            background-size: 40px 40px;
            overflow: hidden; touch-action: manipulation;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- LOADING SCREEN --- */
        #loading-screen {
            position: fixed; inset: 0; background: #fff5f5; z-index: 1000000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-bar-container {
            width: 180px; height: 8px; background: #eee;
            border-radius: 10px; margin-top: 15px; overflow: hidden;
        }
        #loader-bar { width: 0%; height: 100%; background: #ff4d6d; }

        /* --- POLAROIDS (Background Layer) --- */
        .polaroid-scatter {
            position: absolute; background: white; padding: 5px 5px 15px 5px;
            width: 80px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 1;
        }
        .polaroid-scatter img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        
        #p1 { top: 5%; left: 5%; transform: rotate(-10deg); }
        #p2 { top: 5%; right: 5%; transform: rotate(10deg); }
        #p3 { bottom: 5%; left: 5%; transform: rotate(-5deg); }
        #p4 { bottom: 5%; right: 5%; transform: rotate(12deg); }
        #p5 { top: 40%; left: -5%; transform: rotate(-15deg); }
        #p6 { top: 40%; right: -5%; transform: rotate(15deg); }

        /* --- MAIN SCRAPBOOK CARD --- */
        .page { 
            display: none; width: 100%; height: 100%; 
            flex-direction: column; align-items: center; justify-content: center; 
        }
        #page1 { display: flex; }

        .main-card {
            background: #ffffff; /* Clean White Paper */
            padding: 20px; border-radius: 8px;
            z-index: 100; position: relative;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 88%; max-width: 340px;
            max-height: 85vh; /* Prevents overflow */
            overflow-y: auto;
        }

        /* Ransom Text Fixes */
        .ransom { line-height: 1.6; margin: 10px 0; }
        .ransom div { display: inline-block; white-space: nowrap; }
        .ransom span {
            display: inline-block; padding: 2px 5px; margin: 1px;
            background: #f8f9fa; border: 1px solid #eee;
            font-family: 'Special Elite', cursive; font-size: 1.1rem; color: #333;
        }
        .emoji-span { font-family: sans-serif !important; font-size: 1.2rem; }

        /* Video and Buttons Fix */
        video { width: 100%; border-radius: 8px; margin-bottom: 10px; border: 3px solid #f0f0f0; }
        
        .btn-container { 
            display: flex; gap: 15px; justify-content: center; 
            align-items: center; margin-top: 15px; width: 100%;
        }
        button {
            font-family: 'Poppins', sans-serif; font-weight: 600;
            padding: 10px 22px; border-radius: 8px; border: none; 
            cursor: pointer; font-size: 0.9rem;
        }
        #yes { background: #ff4d6d; color: white; flex-shrink: 0; }
        #no { background: #8e8e8e; color: white; position: relative; flex-shrink: 0; }

        /* Heart Trail Toned Down */
        .heart-trail {
            position: fixed; font-size: 20px; pointer-events: none; z-index: 999999;
            font-family: sans-serif !important;
            transition: transform 1s ease-out, opacity 1s ease-out;
        }

        .polaroid-inline { background: white; padding: 5px 5px 15px; width: 90px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin: 5px; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div style="font-size: 30px;">‚ù§Ô∏è</div>
        <p id="loading-text" style="font-size: 14px;">Loading... 0%</p>
        <div class="loader-bar-container"><div id="loader-bar"></div></div>
    </div>

    <audio id="bgMusic" loop><source src="static/bg-music.mp3" type="audio/mpeg"></audio>

    <section id="page1" class="page">
        <div class="polaroid-scatter" id="p1"><img src="static/images/wish1.jpg"></div>
        <div class="polaroid-scatter" id="p2"><img src="static/images/wish2.jpg"></div>
        <div class="polaroid-scatter" id="p3"><img src="static/images/wish3.jpg"></div>
        <div class="polaroid-scatter" id="p4"><img src="static/images/wish4.jpg"></div>
        <div class="polaroid-scatter" id="p5"><img src="static/images/wish5.jpg"></div>
        <div class="polaroid-scatter" id="p6"><img src="static/images/wish6.jpg"></div>

        <div class="main-card">
            <h1 class="ransom" id="t1">Happy Birthday Gorgeous! <span class="emoji-span">üéÇ</span></h1>
            <button style="background:#ff4d6d; color:white; width: 100%;" onclick="startExperience()">Oru question... ‚ù§Ô∏è</button>
        </div>
    </section>

    <section id="page2" class="page">
        <div class="main-card">
            <video autoplay loop muted playsinline><source src="static/images/kisses.mp4" type="video/mp4"></video>
            <h1 class="ransom" id="t2">KEERTHIIIII! MyLOUUUU, will you be my Valentine? (please<span class="emoji-span">üòû</span>)</h1>
            <div class="btn-container">
                <button id="yes" onclick="goToYesPage()">Yes</button>
                <button id="no" onmouseover="moveNo()" onclick="moveNo()">No</button>
            </div>
        </div>
    </section>

    <section id="page3" class="page">
        <div class="main-card">
            <video autoplay loop muted playsinline><source src="static/images/kisses1.mp4" type="video/mp4"></video>
            <h1 class="ransom" id="t3" style="font-size: 0.9rem;">I Looveee YOU SOOO MUCH BABYYYYY<span class="emoji-span">‚ù§Ô∏è</span></h1>
            <div style="display: flex; justify-content: center; flex-wrap: wrap;">
                <div class="polaroid-inline"><img src="static/images/pic1.jpg" style="width:100%"></div>
                <div class="polaroid-inline" style="transform: rotate(5deg);"><img src="static/images/pic2.jpg" style="width:100%"></div>
            </div>
            <button style="background: white; color: #ff4d6d; border: 1px solid #ff4d6d; width: 100%; margin-top: 10px;" onclick="goToFinalVideo()">Sheri Enna üëã</button>
        </div>
    </section>

    <section id="page4" class="page" style="background:#000;">
        <video id="finalVid" controls playsinline style="width:100%; height:100%; object-fit: contain;">
            <source src="static/images/vid1.mp4" type="video/mp4">
        </video>
    </section>

    <script>
        // LOADING BAR
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
                setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);
            }
            document.getElementById('loader-bar').style.width = progress + '%';
            document.getElementById('loading-text').innerText = `Loading... ${Math.floor(progress)}%`;
        }, 120);

        // RANSOM SCRIPT (Word-aware)
        function applyRansom(id) {
            const el = document.getElementById(id);
            const html = el.innerHTML;
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            const nodes = Array.from(tempDiv.childNodes);
            el.innerHTML = '';
            nodes.forEach(node => {
                if (node.nodeType === 3) {
                    node.textContent.split(' ').forEach(word => {
                        if(!word) return;
                        const wordDiv = document.createElement('div');
                        word.split('').forEach(char => {
                            const span = document.createElement('span');
                            span.innerText = char;
                            span.style.transform = `rotate(${(Math.random()*6)-3}deg)`;
                            wordDiv.appendChild(span);
                        });
                        el.appendChild(wordDiv);
                        el.innerHTML += '&nbsp;';
                    });
                } else { el.appendChild(node.cloneNode(true)); }
            });
        }
        applyRansom('t1');

        function startExperience() {
            document.getElementById('bgMusic').play().catch(() => {});
            showPage('page2');
            applyRansom('t2');
        }
        function goToYesPage() {
            showPage('page3');
            applyRansom('t3');
            confetti({ particleCount: 100, spread: 60, origin: { y: 0.7 } });
        }
        function goToFinalVideo() {
            document.getElementById('bgMusic').pause();
            showPage('page4');
            document.getElementById('finalVid').play();
        }
        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.getElementById(id).style.display = 'flex';
        }

        let yesScale = 1;
        function moveNo() {
            const no = document.getElementById("no");
            const yes = document.getElementById("yes");
            no.style.position = "fixed";
            // Keeps it within viewable area
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 50);
            no.style.left = x + "px";
            no.style.top = y + "px";
            yesScale += 0.15;
            yes.style.transform = `scale(${yesScale})`;
        }

        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.6) {
                const h = document.createElement('div');
                h.className = 'heart-trail'; h.innerHTML = '‚ù§Ô∏è';
                h.style.left = e.clientX + 'px'; h.style.top = e.clientY + 'px';
                document.body.appendChild(h);
                setTimeout(() => {
                    h.style.transform = `translate(${(Math.random()-0.5)*80}px, -80px) scale(0.5)`;
                    h.style.opacity = '0';
                }, 50);
                setTimeout(() => h.remove(), 1000);
            }
        });
    </script>
</body>
</html>
